Плагин для оплаты товаров/услуг опубликованных в магазине фриланс-биржи на Cotonti

Разработчик: Булат Юсупов (https://cmsworks.ru)

Copyright CMSWorks Team 2016

Плагин для оплаты товаров/услуг опубликованных в модуле Market. Позволяет оплачивать товары/услуги с указанной ценой. После оплаты Продавец уведомляется по email. При этом сумма за покупку резервируется на счету сайта на гарантийный срок (например 14 дней), чтобы обеспечить безопасность проведения подобного рода продаж через сайт.

После покупки Продавец должен связаться с Покупателем и передать ему товар или оказать оплаченную услугу. Если до завершения гарантийного срока Покупатель обнаружил несоответствия товара/услуги заявленным в описании качествам, он в праве отправить жалобу по своему заказу в адрес Администрации сайта. После этого Администрация сайта будет принимать решение о полном возврате суммы заказа Покупателю или об отмене претензии в зависимости от ситуации.

Если претензий по заказу не было, то по истечению гарантийного срока оплата поступает на счет Продавца с вычетом комиссии сайта, которая заранее устанавливается в настройках плагина.

###Установка:

Распакуйте и скопируйте папку marketorders в директорию plugins/ вашего сайта.
Зайдите в админ-панель сайта и перейдите в раздел "Расширения". Установите плагин Market Orders.
В настройках плагина укажите срока гарантии и размер комиссии сайта за продажи (в процентах).
В шаблоне карточки товара/услуги (market.tpl) добавьте код кнопки для покупки:

<!-- IF {PRD_COST} > 0 AND {PRD_STATE} == 0 -->
    <p>&nbsp;</p>
    <!-- IF {PHP.cot_plugins_active.marketorders} AND {PHP|cot_auth('plug', 'marketorders', 'R')} -->
        <!-- IF {PRD_ORDER_ID} -->
            <a href="{PRD_ORDER_URL}">{PHP.L.marketorders_title}</a>
            <!-- IF {PRD_ORDER_DOWNLOAD} -->
            <p><a class="btn btn-success" href="{PRD_ORDER_DOWNLOAD}">{PHP.L.marketorders_file_download}</a></p>
            <!-- ELSE -->
            <p><span class="label label-info">{PRD_ORDER_LOCALSTATUS}</span></p>
            <!-- ENDIF -->  
         <!-- ELSE -->
             <p><a class="btn btn-large btn-success" href="{PRD_ID|cot_url('marketorders', 'm=neworder&pid='$this)}">{PHP.L.marketorders_neworder_button}</a></p>
         <!-- ENDIF -->
    <!-- ENDIF -->
<!-- ENDIF -->
 

В шапку сайта можно добавить ссылки на покупки и продажи (этот код уже вставлен в базовую версию фриланс-биржи, здесь показан для примера):

<!-- IF {PHP.cot_plugins_active.marketorders} -->
      <li><a href="{PHP|cot_url('marketorders', 'm=sales')}">{PHP.L.marketorders_mysales}</a></li>
      <li><a href="{PHP|cot_url('marketorders', 'm=purchases')}">{PHP.L.marketorders_mypurchases}</a></li>
<!-- ENDIF -->
 

###Настройки для продажи файлов:

Данная возможность еще находится в тестовом режиме. Загружать можно только один файл. Если нужно продавать несколько файлов, то очевидно их необходимо запаковать в один архив и загрузить на странице товара. Ссылка на скачивание товара будет доступна покупателю на странице оплаченного ЗАКАЗА в виде ссылки через скрипт.
 

###Установите плагин или обновите его.
 
По-умолчанию все файлы для продажи будут располагаться в директории datas/marketfiles и при установке или обновлении плагина будет создано экстраполе 'file' для загрузки файлов. Допустимые к загрузке типы файлов: zip и rar. 
В настройках плагина можно указать свой путь к этой директории. Эта директория может располагаться как в директории сайта, либо вы можете указать любую другую директорию (например можно указать директорию в любом месте вашего сервера, с абсолютным путем, чтобы доступа к ней из браузера не было, например /var/www/vhosts/.../files. Но чтобы это сделать, вам нужно узнать у хостера абсолютный путь к нужной вам директории). Если вы измените путь в настройках плагина, то не забудьте также изменить ее в настройках экстраполя 'file' для таблицы market через админку в разделе "Экстраполя". Убедитесь, что указанная директория реально существует и имеет права на запись. Если директория не существует, создайте ее вручную. В настройках созданного экстраполя можно также изменить список допустимого к загрузке файла, но будьте осторожны.
 
Шаблоны добавления и редактирования товара должны содержать поля для загрузки архива, который будет предоставдяться покупателю после покупки.

modules/market/tpl/market.add.tpl

<!-- IF {PHP.cot_plugins_active.marketorders} -->
    <tr>
        <td align="right">{PHP.L.marketorders_file}:</td>
        <td>{PRDADD_FORM_FILE}</td>
    </tr>
<!-- ENDIF -->

modules/market/tpl/market.edit.tpl

<!-- IF {PHP.cot_plugins_active.marketorders} -->
    <tr>
        <td align="right">{PHP.L.marketorders_file}:</td>
        <td>{PRDEDIT_FORM_FILE}</td>
    </tr>
<!-- ENDIF -->
 

 
