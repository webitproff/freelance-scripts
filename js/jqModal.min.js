(function(b){b.fn.jqm=function(a){var m={overlay:50,overlayClass:"jqmOverlay",closeClass:"jqmClose",trigger:".jqModal",ajax:d,ajaxText:"",target:d,modal:d,toTop:d,onShow:d,onHide:d,onLoad:d};return this.each(function(){if(this._jqm)return k[this._jqm].c=b.extend({},k[this._jqm].c,a);g++;this._jqm=g;k[g]={c:b.extend(m,b.jqm.params,a),a:d,w:b(this).addClass("jqmID"+g),s:g};m.trigger&&b(this).jqmAddTrigger(m.trigger)})};b.fn.jqmAddClose=function(a){return q(this,a,"jqmHide")};b.fn.jqmAddTrigger=function(a){return q(this,
a,"jqmShow")};b.fn.jqmShow=function(a){return this.each(function(){b.jqm.open(this._jqm,a)})};b.fn.jqmHide=function(a){return this.each(function(){b.jqm.close(this._jqm,a)})};b.jqm={hash:{},open:function(a,m){var c=k[a],e=c.c,n="."+e.closeClass,h=parseInt(c.w.css("z-index")),h=0<h?h:3E3,f=b("<div></div>").css({height:"100%",width:"100%",position:"fixed",left:0,top:0,"z-index":h-1,opacity:e.overlay/100});if(c.a)return d;c.t=m;c.a=!0;c.w.css("z-index",h);e.modal?(l[0]||r("bind"),l.push(a)):0<e.overlay?
c.w.jqmAddClose(f):f=d;c.o=f?f.addClass(e.overlayClass).prependTo("body"):d;if(s&&(b("html,body").css({height:"100%",width:"100%"}),f)){var f=f.css({position:"absolute"})[0],g;for(g in{Top:1,Left:1})f.style.setExpression(g.toLowerCase(),"(_=(document.documentElement.scroll"+g+" || document.body.scroll"+g+"))+'px'")}e.ajax?(h=e.target||c.w,f=e.ajax,h="string"==typeof h?b(h,c.w):b(h),f="@"==f.substr(0,1)?b(m).attr(f.substring(1)):f,h.html(e.ajaxText).load(f,function(){e.onLoad&&e.onLoad.call(this,c);
n&&c.w.jqmAddClose(b(n,c.w));t(c)})):n&&c.w.jqmAddClose(b(n,c.w));e.toTop&&c.o&&c.w.before('<span id="jqmP'+c.w[0]._jqm+'"></span>').insertAfter(c.o);e.onShow?e.onShow(c):c.w.show();t(c);return d},close:function(a){a=k[a];if(!a.a)return d;a.a=d;l[0]&&(l.pop(),l[0]||r("unbind"));a.c.toTop&&a.o&&b("#jqmP"+a.w[0]._jqm).after(a.w).remove();if(a.c.onHide)a.c.onHide(a);else a.w.hide(),a.o&&a.o.remove();return d},params:{}};var g=0,k=b.jqm.hash,l=[],s=b.browser.msie&&"6.0"==b.browser.version,d=!1,u=b('<iframe src="javascript:false;document.write(\'\');" class="jqm"></iframe>').css({opacity:0}),
t=function(a){s&&(a.o?a.o.html('<p style="width:100%;height:100%"/>').prepend(u):b("iframe.jqm",a.w)[0]||a.w.prepend(u));v(a)},v=function(a){try{b(":input:visible",a.w).length&&b(":input:visible",a.w)[0].focus()}catch(d){}},r=function(a){b()[a]("keypress",p)[a]("keydown",p)[a]("mousedown",p)},p=function(a){var d=k[l[l.length-1]];(a=!b(a.target).parents(".jqmID"+d.s)[0])&&v(d);return!a},q=function(a,g,c){return a.each(function(){var a=this._jqm;b(g).each(function(){this[c]||(this[c]=[],b(this).click(function(){for(var a in{jqmShow:1,
jqmHide:1})for(var b in this[a])if(k[this[a][b]])k[this[a][b]].w[a](this);return d}));this[c].push(a)})})}})(jQuery);
